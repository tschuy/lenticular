<!DOCTYPE HTML>
<html>
<head>
<style>
body {
    width: 100%;
    height: 100%;
    font-family: 'Open Sans', sans-serif;
    font-size: 3em;
    padding: 0px;
    margin: 0px;
    font-weight: 700;
}

canvas {
    position:absolute;
    left:0px;
    top:0px;
}
</style>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:700' rel='stylesheet' type='text/css'>
<script type="text/javascript">

function getLyrics(song_id) {
    var httpRequest;
    makeRequest('song/' + song_id);

    function makeRequest(url) {
        httpRequest = new XMLHttpRequest();

        httpRequest.onreadystatechange = alertContents;
        httpRequest.open('GET', url);
        httpRequest.send();
    }

      function alertContents() {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            runText(httpRequest.responseText);
          } else {
            alert('Song not found!');
          }
      }
    }
}

var drawers = [drawWhiteBackground, drawRedBackground, drawBlueBackground];

function runText(song_json) {
    var song = JSON.parse(song_json);
    var lyrics = song.lyrics;
    console.log(lyrics);
    for (var lyric in lyrics) {
        console.log(lyrics[lyric].color);
        switch (lyrics[lyric].color) {
            case "B":
                console.log("blue");
                var textDrawer = drawBlueBackground;
                break;
            case "R":
                console.log("red");
                var textDrawer = drawRedBackground;
                break;
            case "W":
                console.log("white");
                var textDrawer = drawWhiteBackground;
                break;
        }
        setTimeout(textDrawer.bind(null, lyrics[lyric].french, lyrics[lyric].english), lyrics[lyric].length);
    }
}

function drawBlueBackground(french, english) {
    // BLUE BACKGROUND
    // white text
    // red text
    var ctx = document.getElementById('words').getContext('2d');
    var x = window.innerWidth / 2;
    var y = window.innerHeight / 2;
    ctx.canvas.width  = window.innerWidth;
    ctx.canvas.height = window.innerHeight;
    ctx.fillStyle = "#0100FB";
    ctx.fillRect(0,0,window.innerWidth,window.innerHeight);
    ctx.globalCompositeOperation = 'xor';

    ctx.font = '700 100pt Open Sans';

    ctx.fillStyle = "#FFFFFF";
    textWidth = ctx.measureText(french).width;
    ctx.fillText(french, (ctx.canvas.width/2) - (textWidth / 2), y);


    ctx.globalCompositeOperation = 'darker';
    ctx.fillStyle = "#ea0003";
    textWidth = ctx.measureText(english).width;
    ctx.fillText(english, (ctx.canvas.width/2) - (textWidth / 2), y);
}

function drawRedBackground(french, english) {
    // RED BACKGROUND
    // blue text
    // white text
    var ctx = document.getElementById('words').getContext('2d');
    var x = window.innerWidth / 2;
    var y = window.innerHeight / 2;
    ctx.canvas.width  = window.innerWidth;
    ctx.canvas.height = window.innerHeight;
    ctx.fillStyle = "#EA0003";
    ctx.fillRect(0,0,window.innerWidth,window.innerHeight);

    ctx.font = '700 100pt Open Sans';

    ctx.globalCompositeOperation = 'xor';
    ctx.fillStyle = "#FFFFFF";
    textWidth = ctx.measureText(english).width;
    ctx.fillText(english, (ctx.canvas.width/2) - (textWidth / 2), y);

    ctx.globalCompositeOperation = 'darken';


    ctx.fillStyle = "#0100FB";
    textWidth = ctx.measureText(french).width;
    ctx.fillText(french, (ctx.canvas.width/2) - (textWidth / 2), y);
}

// COLORS
// white: #FFFFFF
// red: #EA0003
// blue: #0100FB

function drawWhiteBackground(french, english) {
    // RED BACKGROUND
    // blue text
    // white text
    var ctx = document.getElementById('words').getContext('2d');
    var x = window.innerWidth / 2;
    var y = window.innerHeight / 2;
    ctx.canvas.width  = window.innerWidth;
    ctx.canvas.height = window.innerHeight;
    ctx.fillStyle = "#FFFFFF";
    ctx.fillRect(0,0,window.innerWidth,window.innerHeight);

    ctx.font = '700 100pt Open Sans';

    ctx.globalCompositeOperation = 'darken';
    ctx.fillStyle = "#0100FB";
    textWidth = ctx.measureText(french).width;
    ctx.fillText(french, (ctx.canvas.width/2) - (textWidth / 2), y);

    ctx.globalCompositeOperation = 'darken';


    ctx.fillStyle = "#EA0003";
    textWidth = ctx.measureText(english).width;
    ctx.fillText(english, (ctx.canvas.width/2) - (textWidth / 2), y);
}
</script>
</head>
<body onload="getLyrics({{ id }});">
    <canvas id='words'></canvas>
</body>
</html>
